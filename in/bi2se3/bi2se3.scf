#!/bin/sh

cat > $prefix.scf.in <<EOF
 &control
  calculation = 'scf'
  title = 'Self-consistent field calculation of $prefix'
  verbosity = 'high'
  restart_mode = 'from_scratch'
  outdir ='$TMP_DIR/'
  prefix ='$prefix'
  pseudo_dir = '$PSEUDO_DIR/'
  tprnfor = .TRUE.
 /
 &system
  ibrav = 5
  celldm(1) = 19.39903060
  celldm(4) = 0.91664744
  nat = 5
  ntyp = 2
  nbnd = $num_band
  ecutwfc = $ecutwfc
  ecutrho = $ecutrho
  occupations = 'fixed' 
  lspinorb = .TRUE.
  noncolin = .TRUE.
  starting_magnetization = 0.0
 /
 &electrons
  electron_maxstep = 100
  conv_thr = 1.0d-8
  mixing_mode = 'plain'
  mixing_beta = 0.3d0
  diagonalization = 'david'
  diago_full_acc = .TRUE.
 /
ATOMIC_SPECIES
 Bi 208.98040  $pseudo_bi
 Se 078.97100  $pseudo_se
ATOMIC_POSITIONS {angstrom}
 Se 0.00000000 0.00000000  0.000000000
 Se 0.00000000 0.00000000  6.442648844
 Bi 0.00000000 0.00000000 11.923902056
 Bi 0.00000000 0.00000000 18.004785754
 Se 0.00000000 0.00000000 23.486038966
K_POINTS {automatic}
 $num_kx $num_ky $num_kz 0 0 0
EOF

$PW_COMMAND < $prefix.scf.in > $prefix.scf.out
check_failure $?
$ECHO " done"
